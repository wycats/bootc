<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE fontconfig SYSTEM "urn:fontconfig:fonts.dtd">
<!--
  Surgical emoji fix for Electron/Chromium apps on Fedora 43+.
  
  Problem: Noto Color Emoji uses COLRv1 format which renders as
  monochrome/broken in Chromium's Skia renderer.
  
  Strategy: "Reject, Don't Force"
  1. Hide Noto Color Emoji from fontconfig so it's never selected
  2. Map the "emoji" generic family to Twemoji (weak binding)
  3. Fix the name mismatch: Fedora's 60-generic.conf lists
     "Twitter Color Emoji" but the installed font is "Twemoji"
  
  This avoids the binding="strong" mistake that hijacked text fonts
  (Kannada, CJK, etc.) in prior attempts.
-->
<fontconfig>
  <!-- Hide Noto Color Emoji (COLRv1) from all font lookups -->
  <selectfont>
    <rejectfont>
      <pattern>
        <patelt name="family">
          <string>Noto Color Emoji</string>
        </patelt>
      </pattern>
    </rejectfont>
  </selectfont>

  <!-- 
    Fix name mismatch: Fedora's 60-generic.conf lists "Twitter Color Emoji"
    but the installed package (twitter-twemoji-fonts) provides family "Twemoji".
    This alias ensures the fallback chain finds it.
  -->
  <alias>
    <family>Twitter Color Emoji</family>
    <prefer><family>Twemoji</family></prefer>
  </alias>

  <!--
    Weak hint: when generic "emoji" is requested, prefer Twemoji.
    Uses binding="weak" so text fonts (Kannada, CJK, etc.) are
    never affected.
  -->
  <match target="pattern">
    <test name="family"><string>emoji</string></test>
    <edit name="family" mode="prepend" binding="weak">
      <string>Twemoji</string>
    </edit>
  </match>

  <!--
    Cross-platform aliases: apps that request platform-specific emoji
    fonts get redirected to Twemoji.
  -->
  <alias>
    <family>Apple Color Emoji</family>
    <prefer><family>Twemoji</family></prefer>
  </alias>

  <alias>
    <family>Segoe UI Emoji</family>
    <prefer><family>Twemoji</family></prefer>
  </alias>
</fontconfig>
