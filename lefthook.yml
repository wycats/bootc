pre-commit:
  parallel: true
  commands:
    check-schemas:
      glob: "bkt/src/**/*.rs"
      run: |
        cargo run -q --manifest-path bkt/Cargo.toml -- schema generate --output schemas
        git diff --exit-code -- schemas

    check-containerfile:
      glob: "{manifests/*.json,bkt/src/**/*.rs}"
      run: |
        cargo run -q --manifest-path bkt/Cargo.toml -- containerfile sync
        git add Containerfile

    fmt:
      glob: "bkt/**/*.rs"
      run: |
        cargo fmt --manifest-path bkt/Cargo.toml
        git add {staged_files}

    clippy:
      glob: "bkt/**/*.rs"
      run: |
        cargo clippy --manifest-path bkt/Cargo.toml --fix --allow-dirty --allow-staged
        git add {staged_files}

pre-push:
  parallel: true
  commands:
    check-schemas:
      glob: "bkt/src/**/*.rs"
      run: |
        cargo run -q --manifest-path bkt/Cargo.toml -- schema generate --output schemas
        git diff --exit-code -- schemas

    check-containerfile:
      glob: "{manifests/*.json,bkt/src/**/*.rs}"
      run: cargo run -q --manifest-path bkt/Cargo.toml -- containerfile check

    fmt:
      glob: "bkt/**/*.rs"
      run: cargo fmt --manifest-path bkt/Cargo.toml -- --check

    clippy:
      glob: "bkt/**/*.rs"
      run: cargo clippy --manifest-path bkt/Cargo.toml -- -D warnings
